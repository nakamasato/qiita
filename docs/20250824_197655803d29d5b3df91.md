---
title: Clerk Billingで簡単にアプリにSubscription機能を追加する方法
tags: Clerk ClerkBilling
author: nakamasato
slide: false
---
## はじめに

Stripeを使った決済機能の実装は、APIルートやWebhook処理など多くのコードが必要で時間がかかります。

**Clerk Billing**を使えば、これらの実装をほぼゼロにして、決済機能を爆速で追加できます。

本記事では、Clerk Billingを使ってNext.jsアプリに**コード0行**で決済機能を実装する方法を解説します。

Clerk自体のまとめはこちらをご参照ください。

https://qiita.com/nakamasato/items/e5ac6ccf01c2b07b6ff1

## Clerk Billingとは？

Clerk Billingは、認証サービスで有名な[Clerk](https://clerk.com)が提供する**サブスクリプション管理Beta機能**です。

https://clerk.com/docs/billing/overview

StripeのアカウントをClerk連携で作成し、0.7％の手数料をClerkに払うことで、User認証、プラン選択支払い、Planに紐づくFeaturesの制御を簡単に実装することができます。


### 従来のStripe実装との違い

#### 🔴 従来のStripe実装
```javascript
// APIルート、Webhook、顧客管理...
// 数百行のコードが必要
const stripe = require('stripe')(process.env.STRIPE_SECRET_KEY);
const subscription = await stripe.subscriptions.create({...});
// さらにWebhook処理、エラーハンドリング、etc...
```

#### 🟢 Clerk Billing

```jsx
import { PricingTable } from '@clerk/nextjs'

export default function Page() {
  return <PricingTable />
}
```

これを追加するだけで、Clerk Dashboard上で設定したPricingを表示することができ、そのまま決済してSubscribeする機能を提供できます。（Ref: https://clerk.com/docs/nextjs/components/billing/pricing-table）

![Screenshot 2025-08-24 at 10.13.35.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/7059/f495382c-ebc0-4a9a-958a-b7f9c840b84b.png)


## Clerk Billingを選ぶメリットとデメリット

### ✅ Pros（メリット）

1. **実装速度が圧倒的に速い**
   1. 決済機能の実装が**最短10分**で完了
   1. APIルート、Webhook処理が不要
2. **開発者体験（DX）が優れている**
   1. Development Gateway（共有テスト環境）ですぐテスト可能
   1. Stripeアカウント不要で開発開始
3. **セキュリティが万全**
   1. PCI DSS準拠を自動で実現
   1. 決済情報を扱わないので安全
4. **UIコンポーネントが充実**
   1. 価格表、請求管理画面が用意済み
   1. カスタマイズも可能
5. **認証と決済の統合**
   1. ユーザー認証と課金状態が自動同期
   1. `has({ plan: 'pro' })`で簡単にアクセス制御

### ❌ Cons（デメリット）

1. **Clerk BillingはまだBeta版**
    1. 将来的にBreaking changeが行われる可能性がある
1. **Clerkへの依存（強いベンダーロックイン）**
   1. 認証システムもClerkを使う必要がある
   1. StripeアカウントもClerkとセットになる
   1. 将来的な移行が非常に困難
2. **カスタマイズの制限**
   1. 複雑な料金体系や顧客ごとのカスタマイズには対応しづらい
   1. 独自の決済フローを作りにくい
   1. 決済通貨はUSDになる
3. **コスト**
   1. Clerkの利用料金（認証機能）にプラスして、Clerk Billingに対して決済額の0.7%の手数料として追加
   1. 小規模なら問題ないが、スケール時に要検討
4. **日本語対応**
   1. UIコンポーネントの日本語化に制限あり
   1. ドキュメントは英語中心

<details><summary>日本語だとうまく表示されないケース❌️</summary>

![Screenshot 2025-08-25 at 11.43.26.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/7059/8e19f8e7-2321-45ec-a07e-e556a0ae7fb5.png)

</details>


## 実装手順

実装は大きく2つのステップに分かれます：

1. **Clerk Dashboardでの設定**（管理画面での作業）
2. **Next.jsアプリへの実装**（コードの追加）

### Clerk Dashboardでの設定

![Screenshot 2025-08-22 at 20.19.51.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/7059/37f41a12-9590-4fc2-8002-607a42bf119d.png)


#### 1. Clerk Billingを有効化

Clerk Dashboardで以下の手順を実行：

1. **Configure > Billing** に移動
2. **"Enable Billing"** をクリック
3. **Development Gateway** を選択（テスト用）

![Screenshot 2025-08-24 at 10.21.09.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/7059/0f31e655-f59a-4ee9-8972-43f205ea2fb4.png)


#### 2. サブスクリプションプランを作成

Clerk Dashboardで以下の手順を実行：

1. **Configure > Subscription Plans** に移動
2. **"Add User Plan"**（B2C向け）または **"Add Organization Plan"**（B2B向け）をクリック
3. 各プランを作成：

![Screenshot 2025-08-23 at 10.03.37.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/7059/815ae44c-ace7-47df-8f83-f0d02240a579.png)


プランの例: 
**Free Plan**
- Name: `free`
- Price: $0/month
- Description: Always free
- Features: なし（基本アクセスのみ）

**Pro Plan**
- Name: `pro`
- Price: $20/month
- Description: For professionals
- Features:
  - monitoring
  - free delivery

**Max Plan**
- Name: `max`
- Price: $100/month
- Description: Maximum features
- Features:
  - Chat Support
  - monitoring
  - free delivery

4. すべてのプランを **Publish** して利用可能にする


:::note info
- User Plan: B2C向け
- Organization Plan: B2B向け

を自分のサービスに合わせて選択して設定します。
:::


### Next.jsアプリへの実装

#### 1. 価格表ページを実装

```tsx
// app/pricing/page.tsx
import { PricingTable } from '@clerk/nextjs';

export default function PricingPage() {
  return (
    <div className="container mx-auto py-16">
      <h1 className="text-4xl font-bold text-center mb-8">
        料金プラン
      </h1>
      
      {/* これだけで価格表が表示される！ */}
      <PricingTable />
    </div>
  );
}
```

#### 2. 課金管理画面を追加

```tsx
// app/account/page.tsx
export default function AccountPage() {
  return (
    <div className="container mx-auto py-16">
      <h1 className="text-3xl font-bold mb-8">
        アカウント設定
      </h1>
      
      {/* 課金管理UIが自動で表示される */}
      <clerk-billing-portal />
    </div>
  );
}
```

#### 3. アクセス制御を実装

```tsx
// app/premium/page.tsx
import { auth } from '@clerk/nextjs/server';

export default async function PremiumPage() {
  const { has } = await auth();
  
  // プランをチェック
  if (!has({ plan: ['pro', 'max'] })) {
    return (
      <div>
        <p>このコンテンツはPro以上のプランが必要です</p>
        <a href="/pricing">アップグレード</a>
      </div>
    );
  }
  
  return <div>プレミアムコンテンツ</div>;
}
```

### 開発環境でのテスト

```bash
# テストカード番号
4242 4242 4242 4242

# CVV: 任意の3桁
# 有効期限: 未来の日付
```

<!--

## よくある質問

### Q: 既存のStripeアカウントは使える？
A: はい、本番環境では既存のStripeアカウントを接続できます。

### Q: 返金処理はどうする？
A: Clerk DashboardまたはStripe Dashboardから処理可能です。

### Q: 無料トライアルは設定できる？
A: はい、プラン作成時にトライアル期間を設定できます。

-->

## まとめ

Clerk Billingは、以下のようなプロジェクトに最適です：

✅ **おすすめケース**
- MVPやプロトタイプの迅速な開発
- シンプルなSaaSの課金機能
- 個人開発やスタートアップ
- Clerkで認証を既に実装している
- 英語とUSDベースのGlobalを相手にしたプロダクト

❌ **不向きなケース**
- 決済通貨は日本円にしたい
- 設定は日本語で表示したい
- 複雑な料金体系が必要
- 完全なカスタマイズが必要
- 大規模エンタープライズ
- Clerk以外の認証システムを使用中

## 参考リンク

- [Clerk Billing公式ドキュメント](https://clerk.com/docs/billing/overview)
- [Clerk Dashboard](https://dashboard.clerk.com)
- [Stripe docs](https://stripe.com/docs)

