---
title: Claude Code GitHub Actions + Slack MCPで毎月のGitHub 活動サマリーをSlackに投稿する
tags: ClaudeCode GitHubActions ClaudeCodeAction MCP
author: nakamasato
slide: false
---
:::note info
2025/10/29 更新版[Claude Code GitHub ActionsでGitHub×Slack×Notionを連携した高度なプロジェクトサマリー自動生成
](https://qiita.com/nakamasato/items/74944de7dba56d0022ff)を書いたのでこちらもご覧ください。
:::


## はじめに

開発チームでは、毎月の進捗や成果を共有することは重要ですが、手動でサマリーを作成するのは時間がかかり、忙しいときには忘れてしまいがちです。そこで、Claude Code GitHub ActionsとSlack MCPを組み合わせて、GitHub上のプルリクエスト（PR）データから自動的に月次活動サマリーを生成し、Slackに投稿するシステムを構築しました。

実装方法と使い方について解説します。

## システム概要

このシステムは以下の技術を組み合わせて構成されています：

- **GitHub Actions**: ワークフローの実行基盤
- **Claude Code**: PRデータの分析とサマリー生成
- **Slack MCP (Model Context Protocol)**: Slackへの投稿機能
- **GitHub CLI**: PRデータの取得

## 特徴

### 主な機能

- **自動PRデータ取得**: 指定した月のマージされたPRを自動取得
- **インテリジェントな分析**: Claude CodeによるPRデータの分析とサマリー生成
- **カテゴリ別整理**: 機能開発、テスト、インフラなど、作業内容を自動でカテゴリ分け
- **Slack自動投稿**: 整理されたサマリーをSlackチャンネルに自動投稿
- **柔軟な設定**: reusable workflowにしたので、使いたいレポジトリからscheduleで毎月1日実行するようにセットしたり、workflow_dispatchでアドホックに実行が可能

### 生成されるサマリーの例

![Screenshot 2025-08-05 at 20.16.58.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/7059/e6f94956-d0f6-4a00-83bf-6441046ee30b.png)

```
12月もお疲れ様です！ my-project 活動サマリーです。合計15のPRがマージされました!

*機能開発*
• ユーザー認証機能の追加 (#123, #125)
• API レスポンス形式の改善 (#130)

*テスト・品質向上*
• テストカバレッジの向上 (#135, #140)
• リファクタリング作業 (#145)

*インフラ・運用*
• CI/CDパイプラインの改善 (#150)

今月も素晴らしい成果です！来月も頑張りましょう！
```

## 実装詳細

### 1. 再利用可能なワークフローの作成

まず、他のリポジトリから呼び出せるComposite Actionsワークフローを作成します。

```yaml
name: 'Monthly Project Summary to Slack'
description: 'Generate monthly project summaries with Claude Code and post to Slack'
author: 'nakamasato'

inputs:
  repository:
    description: 'Target repository (owner/repo format). If not specified, uses current repository'
    required: false
    default: ${{ github.repository }}
  yearmonth:
    description: 'Target year-month (YYYY-MM format). If not specified, uses last month'
    required: false
  slack_channel:
    description: 'Slack channel ID for posting results'
    required: true
  timeout_minutes:
    description: 'Timeout in minutes for Claude Code execution'
    required: false
    default: '5'
  github_token:
    description: 'GitHub Token for repository access (supports GitHub App tokens for cross-org access)'
    required: false
    default: ${{ github.token }}
  slack_bot_token:
    description: 'Slack Bot Token'
    required: true
  slack_team_id:
    description: 'Slack Team ID'
    required: true
  claude_code_oauth_token:
    description: 'Claude Code OAuth Token'
    required: false
  anthropic_api_key:
    description: 'Anthropic API Key'
    required: false
```

### 2. パラメータの設定

```yaml
    - name: Set parameters
      id: set-params
      shell: bash
      run: |
        # リポジトリの設定
        if [ -n "${{ inputs.repository }}" ]; then
          TARGET_REPO="${{ inputs.repository }}"
        else
          TARGET_REPO="${{ github.repository }}"
        fi

        # 年月の設定
        if [ -n "${{ inputs.yearmonth }}" ]; then
          TARGET_MONTH="${{ inputs.yearmonth }}"
        else
          # 前月を取得
          TARGET_MONTH=$(date -d "last month" +%Y-%m)
        fi

        echo "TARGET_REPO=${TARGET_REPO}" >> "$GITHUB_OUTPUT"
        echo "TARGET_MONTH=${TARGET_MONTH}" >> "$GITHUB_OUTPUT"
```

### 3. PRデータの取得

GitHub CLIを使用して、指定された期間のマージされたPRデータを取得します。

```yaml
    - name: Generate PR data
      id: generate-pr-data
      shell: bash
      env:
        GH_TOKEN: ${{ inputs.github_token }}
      run: |
        # 対象月の開始日と終了日を計算
        TARGET_MONTH="${{ steps.set-params.outputs.TARGET_MONTH }}"
        TARGET_REPO="${{ steps.set-params.outputs.TARGET_REPO }}"
        START_DATE="${TARGET_MONTH}-01"

        # 次月の1日を計算
        YEAR=$(echo $TARGET_MONTH | cut -d'-' -f1)
        MONTH_NUM=$(echo $TARGET_MONTH | cut -d'-' -f2)
        if [ "$MONTH_NUM" = "12" ]; then
            NEXT_YEAR=$((YEAR + 1))
            NEXT_MONTH_NUM="01"
        else
            NEXT_YEAR=$YEAR
            NEXT_MONTH_NUM=$(printf "%02d" $((10#$MONTH_NUM + 1)))
        fi
        END_DATE="${NEXT_YEAR}-${NEXT_MONTH_NUM}-01"

        echo "Searching PRs merged between ${START_DATE} and ${END_DATE} in ${TARGET_REPO}"

        # PRを検索してJSONファイルに保存（指定されたリポジトリに限定）
        gh search prs --repo "${TARGET_REPO}" --merged --merged-at "${START_DATE}..${END_DATE}" --json title,body,number --limit 100 > pr_data.json
        echo "pr-data-file=pr_data.json" >> "$GITHUB_OUTPUT"
```

使ってるgh commandはこちらです。

```bash
gh search prs --repo "${TARGET_REPO}" --merged --merged-at "${START_DATE}..${END_DATE}" --json title,body,number --limit 100
```

### 4. Claude Codeによる分析とサマリー生成

Claude Code GitHub Actionを使用して、PRデータを分析し、読みやすいサマリーを生成します。Slack MCPサーバーも同時に設定して、Claude CodeからSlackに直接投稿できるようにします。

```yaml
    - name: Run Claude Code with MCP
      uses: anthropics/claude-code-base-action@61ac761b1f115cab220505847e10a02eac2e774d
      with:
        timeout_minutes: ${{ inputs.timeout_minutes }}
        claude_code_oauth_token: ${{ inputs.claude_code_oauth_token }}
        anthropic_api_key: ${{ inputs.anthropic_api_key }}
        mcp_config: |
          {
            "mcpServers": {
              "slack": {
                "command": "npx",
                "args": ["-y", "@modelcontextprotocol/server-slack"],
                "env": {
                  "SLACK_BOT_TOKEN": "${{ inputs.slack_bot_token }}",
                  "SLACK_TEAM_ID": "${{ inputs.slack_team_id }}"
                }
              }
            }
          }
        system_prompt: |
          あなたは月次プロジェクトサマリーレポートを生成するAIアシスタントです。
          GitHub PRデータを分析して、読みやすい月次活動報告書を作成してください。
        allowed_tools: "Bash,Grep,Glob,Read,Write,Edit,MultiEdit,LS,Task,TodoRead,TodoWrite,mcp__slack__slack_post_message"
        prompt: |
          target_repo: ${{ steps.set-params.outputs.TARGET_REPO }}

          ${{ steps.set-params.outputs.TARGET_MONTH }}月の月次プロジェクトサマリーを生成してください。

          PRデータは以下のファイルに保存されています：
          ファイル: ${{ steps.generate-pr-data.outputs.pr-data-file }}

          以下の手順で実行してください：

          1. **PRデータの読み込み**
             まず、Readツールを使って上記のファイルからPRデータを読み込んでください。

             JSONファイルの形式：
             ```json
             [
               {
                 "title": "PR title",
                 "body": "PR description",
                 "number": 123
               },
               ...
             ]
             ```

             **処理のTips：**
             - PRが50件以上ある場合は、まずBashツールで `jq 'length' pr_data.json` を実行して件数を確認
             - 件数が多い場合は `jq '.[].title' pr_data.json` でタイトルのリストを取得して全体像を把握
             - 重要そうなPRを特定してから、必要に応じて詳細なbodyを個別に確認

          2. **月次レポートの生成**
             読み込んだPRデータから以下の形式で月次活動報告書を生成してください：

             ```
             $(echo ${{ steps.set-params.outputs.TARGET_MONTH }} | cut -d'-' -f2 | sed 's/^0//')月もお疲れ様です！ <https://github.com/<target_repo>|<target_repo>> 活動サマリーです。合計$(jq length pr_data.json)のPRがマージされました!

             *[カテゴリ1]*
             • [具体的な作業内容1] (<https://github.com/<target_repo>/pull/123|#123>, <https://github.com/<target_repo>/pull/125|#125>, ... <- 関連するPR number list)
             • [具体的な作業内容2] (<https://github.com/<target_repo>/pull/130|#130>, ... <- 関連するPR number list)

             *[カテゴリ2]*
             • [具体的な作業内容1] (<https://github.com/<target_repo>/pull/135|#135>, ... <- 関連するPR number list)

             *その他*
             • [その他の作業内容（存在する場合のみ）] (<https://github.com/<target_repo>/pull/140|#140>, ... <- 関連するPR number list)

             <勇気づけの一言を考えて。今月も頑張っていけるように。>
             ```

             **要件：**
             - PRのタイトルと説明から作業内容を抽出し、関連する作業をカテゴリ別にグループ化
             - テスト関連、インフラ関連、機能開発関連など適切なカテゴリに分類
             - 技術的すぎず、わかりやすい表現に変換
             - Slack用のフォーマット：太字は*text*、リストは•を使用
             - 日本語で丁寧な文体（アルファベット単語はそのまま使用）
             - 開発者名は含めない（チーム全体の成果として記載）
             - カテゴリは大まかに分けて2〜3個（最大5個）に分類
             - 各カテゴリの間に空行を入れて見やすくする
             - PR番号はリンク形式で記載：`<https://github.com/<target_repo>/pull/123|#123>`

          3. **Slackへの投稿**
             すべての処理が終わったら、Slack MCPツール（mcp__slack__slack_post_message）を使って以下に投稿してください：
             - channel: ${{ inputs.slack_channel }}

             **Slackメッセージフォーマット要件：**
             1. **見出し構造：**
                - メインタイトル：太字（*タイトル*）
                - セクション見出し：太字（*見出し*）
                - サブ見出し：太字（*サブ見出し*）

             2. **リスト形式：**
                - 番号付きリスト：`1.`, `2.`, `3.`...
                - 箇条書きリスト：`•` または `-`
                - インデント：サブ項目は適切にインデントを使用

             3. **強調とマーキング：**
                - 重要な情報：太字（*重要*）
                - コードやコマンド：バッククォート（`コード`）
                - 斜体テキスト：アンダースコア（_斜体_）
                - 取り消し線：チルダ（~取り消し~）
                - 推奨事項：⭐️ または ✨ の絵文字を使用
                - 注意事項：⚠️ または 🔔 の絵文字を使用

             4. **リンク：**
                - URLは適切にリンク化（<URL|リンクテキスト>）
                - 重要なリンクは改行して見やすく配置

             5. **改行と空白：**
                - セクション間は適切な改行を入れて読みやすく
                - 長い文章は適切に改行して視認性を向上

             6. **絵文字の使用：**
                - 内容に応じて適切な絵文字を使用（📄 📋 ✅ 🔧 等）
                - 過度に使用せず、情報の整理に役立つ範囲で使用
```

## Workflow詳細

### Workflow全体の定義

長いので、畳んであります。コードは [monthly-project-summary-slack/action.yml](https://github.com/nakamasato/github-actions/blob/main/monthly-project-summary-slack/action.yml) にあります。

<details><summary>monthly-project-summary-slack.yml</summary>

```yaml
name: 'Monthly Project Summary to Slack'
description: 'Generate monthly project summaries with Claude Code and post to Slack'
author: 'nakamasato'

inputs:
  repository:
    description: 'Target repository (owner/repo format). If not specified, uses current repository'
    required: false
    default: ${{ github.repository }}
  yearmonth:
    description: 'Target year-month (YYYY-MM format). If not specified, uses last month'
    required: false
  slack_channel:
    description: 'Slack channel ID for posting results'
    required: true
  timeout_minutes:
    description: 'Timeout in minutes for Claude Code execution'
    required: false
    default: '5'
  github_token:
    description: 'GitHub Token for repository access (supports GitHub App tokens for cross-org access)'
    required: false
    default: ${{ github.token }}
  slack_bot_token:
    description: 'Slack Bot Token'
    required: true
  slack_team_id:
    description: 'Slack Team ID'
    required: true
  claude_code_oauth_token:
    description: 'Claude Code OAuth Token'
    required: false
  anthropic_api_key:
    description: 'Anthropic API Key'
    required: false

runs:
  using: 'composite'
  steps:
    - name: Set parameters
      id: set-params
      shell: bash
      run: |
        # リポジトリの設定
        if [ -n "${{ inputs.repository }}" ]; then
          TARGET_REPO="${{ inputs.repository }}"
        else
          TARGET_REPO="${{ github.repository }}"
        fi

        # 年月の設定
        if [ -n "${{ inputs.yearmonth }}" ]; then
          TARGET_MONTH="${{ inputs.yearmonth }}"
        else
          # 前月を取得
          TARGET_MONTH=$(date -d "last month" +%Y-%m)
        fi

        echo "TARGET_REPO=${TARGET_REPO}" >> "$GITHUB_OUTPUT"
        echo "TARGET_MONTH=${TARGET_MONTH}" >> "$GITHUB_OUTPUT"

    - name: Generate PR data
      id: generate-pr-data
      shell: bash
      env:
        GH_TOKEN: ${{ inputs.github_token }}
      run: |
        # 対象月の開始日と終了日を計算
        TARGET_MONTH="${{ steps.set-params.outputs.TARGET_MONTH }}"
        TARGET_REPO="${{ steps.set-params.outputs.TARGET_REPO }}"
        START_DATE="${TARGET_MONTH}-01"

        # 次月の1日を計算
        YEAR=$(echo $TARGET_MONTH | cut -d'-' -f1)
        MONTH_NUM=$(echo $TARGET_MONTH | cut -d'-' -f2)
        if [ "$MONTH_NUM" = "12" ]; then
            NEXT_YEAR=$((YEAR + 1))
            NEXT_MONTH_NUM="01"
        else
            NEXT_YEAR=$YEAR
            NEXT_MONTH_NUM=$(printf "%02d" $((10#$MONTH_NUM + 1)))
        fi
        END_DATE="${NEXT_YEAR}-${NEXT_MONTH_NUM}-01"

        echo "Searching PRs merged between ${START_DATE} and ${END_DATE} in ${TARGET_REPO}"

        # PRを検索してJSONファイルに保存（指定されたリポジトリに限定）
        gh search prs --repo "${TARGET_REPO}" --merged --merged-at "${START_DATE}..${END_DATE}" --json title,body,number --limit 100 > pr_data.json
        echo "pr-data-file=pr_data.json" >> "$GITHUB_OUTPUT"

    - name: Run Claude Code with MCP
      uses: anthropics/claude-code-base-action@61ac761b1f115cab220505847e10a02eac2e774d
      with:
        timeout_minutes: ${{ inputs.timeout_minutes }}
        claude_code_oauth_token: ${{ inputs.claude_code_oauth_token }}
        anthropic_api_key: ${{ inputs.anthropic_api_key }}
        mcp_config: |
          {
            "mcpServers": {
              "slack": {
                "command": "npx",
                "args": ["-y", "@modelcontextprotocol/server-slack"],
                "env": {
                  "SLACK_BOT_TOKEN": "${{ inputs.slack_bot_token }}",
                  "SLACK_TEAM_ID": "${{ inputs.slack_team_id }}"
                }
              }
            }
          }
        system_prompt: |
          あなたは月次プロジェクトサマリーレポートを生成するAIアシスタントです。
          GitHub PRデータを分析して、読みやすい月次活動報告書を作成してください。
        allowed_tools: "Bash,Grep,Glob,Read,Write,Edit,MultiEdit,LS,Task,TodoRead,TodoWrite,mcp__slack__slack_post_message"
        prompt: |
          target_repo: ${{ steps.set-params.outputs.TARGET_REPO }}

          ${{ steps.set-params.outputs.TARGET_MONTH }}月の月次プロジェクトサマリーを生成してください。

          PRデータは以下のファイルに保存されています：
          ファイル: ${{ steps.generate-pr-data.outputs.pr-data-file }}

          以下の手順で実行してください：

          1. **PRデータの読み込み**
             まず、Readツールを使って上記のファイルからPRデータを読み込んでください。

             JSONファイルの形式：
             ```json
             [
               {
                 "title": "PR title",
                 "body": "PR description",
                 "number": 123
               },
               ...
             ]
             ```

             **処理のTips：**
             - PRが50件以上ある場合は、まずBashツールで `jq 'length' pr_data.json` を実行して件数を確認
             - 件数が多い場合は `jq '.[].title' pr_data.json` でタイトルのリストを取得して全体像を把握
             - 重要そうなPRを特定してから、必要に応じて詳細なbodyを個別に確認

          2. **月次レポートの生成**
             読み込んだPRデータから以下の形式で月次活動報告書を生成してください：

             ```
             $(echo ${{ steps.set-params.outputs.TARGET_MONTH }} | cut -d'-' -f2 | sed 's/^0//')月もお疲れ様です！ <https://github.com/<target_repo>|<target_repo>> 活動サマリーです。合計$(jq length pr_data.json)のPRがマージされました!

             *[カテゴリ1]*
             • [具体的な作業内容1] (<https://github.com/<target_repo>/pull/123|#123>, <https://github.com/<target_repo>/pull/125|#125>, ... <- 関連するPR number list)
             • [具体的な作業内容2] (<https://github.com/<target_repo>/pull/130|#130>, ... <- 関連するPR number list)

             *[カテゴリ2]*
             • [具体的な作業内容1] (<https://github.com/<target_repo>/pull/135|#135>, ... <- 関連するPR number list)

             *その他*
             • [その他の作業内容（存在する場合のみ）] (<https://github.com/<target_repo>/pull/140|#140>, ... <- 関連するPR number list)

             <勇気づけの一言を考えて。今月も頑張っていけるように。>
             ```

             **要件：**
             - PRのタイトルと説明から作業内容を抽出し、関連する作業をカテゴリ別にグループ化
             - テスト関連、インフラ関連、機能開発関連など適切なカテゴリに分類
             - 技術的すぎず、わかりやすい表現に変換
             - Slack用のフォーマット：太字は*text*、リストは•を使用
             - 日本語で丁寧な文体（アルファベット単語はそのまま使用）
             - 開発者名は含めない（チーム全体の成果として記載）
             - カテゴリは大まかに分けて2〜3個（最大5個）に分類
             - 各カテゴリの間に空行を入れて見やすくする
             - PR番号はリンク形式で記載：`<https://github.com/<target_repo>/pull/123|#123>`

          3. **Slackへの投稿**
             すべての処理が終わったら、Slack MCPツール（mcp__slack__slack_post_message）を使って以下に投稿してください：
             - channel: ${{ inputs.slack_channel }}

             **Slackメッセージフォーマット要件：**
             1. **見出し構造：**
                - メインタイトル：太字（*タイトル*）
                - セクション見出し：太字（*見出し*）
                - サブ見出し：太字（*サブ見出し*）

             2. **リスト形式：**
                - 番号付きリスト：`1.`, `2.`, `3.`...
                - 箇条書きリスト：`•` または `-`
                - インデント：サブ項目は適切にインデントを使用

             3. **強調とマーキング：**
                - 重要な情報：太字（*重要*）
                - コードやコマンド：バッククォート（`コード`）
                - 斜体テキスト：アンダースコア（_斜体_）
                - 取り消し線：チルダ（~取り消し~）
                - 推奨事項：⭐️ または ✨ の絵文字を使用
                - 注意事項：⚠️ または 🔔 の絵文字を使用

             4. **リンク：**
                - URLは適切にリンク化（<URL|リンクテキスト>）
                - 重要なリンクは改行して見やすく配置

             5. **改行と空白：**
                - セクション間は適切な改行を入れて読みやすく
                - 長い文章は適切に改行して視認性を向上

             6. **絵文字の使用：**
                - 内容に応じて適切な絵文字を使用（📄 📋 ✅ 🔧 等）
                - 過度に使用せず、情報の整理に役立つ範囲で使用

    - name: Send error notification to Slack
      if: failure()
      shell: bash
      run: |
        curl -X POST -H 'Content-type: application/json' \
          -H "Authorization: Bearer ${{ inputs.slack_bot_token }}" \
          -d '{
            "channel": "${{ inputs.slack_channel }}",
            "text": "⚠️ *月次サマリー生成でエラーが発生しました*\n\nRepository: ${{ steps.set-params.outputs.TARGET_REPO }}\nMonth: ${{ steps.set-params.outputs.TARGET_MONTH }}\n\n処理中にエラーが発生しました。詳細は<https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}|こちら>をご確認ください。",
            "mrkdwn": true
          }' \
          https://slack.com/api/chat.postMessage

branding:
  icon: 'message-circle'
  color: 'blue'

```

</details>

### Inputsの詳細

| パラメータ | 必須 | 説明 | デフォルト値 |
|-----------|------|------|-------------|
| `repository` | No | 対象リポジトリ（owner/repo形式） | 現在のリポジトリ |
| `yearmonth` | No | 対象年月（YYYY-MM形式） | 前月 |
| `slack_channel` | Yes | Slack投稿先チャンネルID | - |
| `timeout_minutes` | No | Claude Code実行のタイムアウト（分） | 5 |
| `github_token` | No | GitHub Token（クロスリポジトリアクセス用） |
| `slack_bot_token` | Yes | Slack Bot Token |
| `slack_team_id` | Yes | Slack Team ID |
| `claude_code_oauth_token` | No* | Claude Code OAuth Token |
| `anthropic_api_key` | No* | Anthropic API Key |

*`claude_code_oauth_token`または`anthropic_api_key`のどちらか一つが必要

## 使用方法

### 1. 基本的な使用方法

```yaml
name: Monthly Project Summary
on:
  schedule:
    - cron: '0 9 1 * *'  # 毎月1日9時に実行
  workflow_dispatch:

jobs:
  generate-summary:
    runs-on: ubuntu-latest
    steps:
      - name: Generate monthly summary
        uses: nakamasato/github-actions/monthly-project-summary-slack@1.13.1
        with:
          slack_channel: C1234567890
          slack_bot_token: ${{ secrets.SLACK_BOT_TOKEN }}
          slack_team_id: ${{ secrets.SLACK_TEAM_ID }}
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
```

### 2. 複数のレポジトリに設定

GitHub Appを作成して、Read権限を付与しておけば、一個のレポに repoとslack channelのペアを設定することで複数レポに簡単に設定ができます。

```yaml
name: Monthly Project Summary - Multiple Repos
on:
  schedule:
    - cron: '0 9 1 * *'  # 毎月1日9時に実行
  workflow_dispatch:

jobs:
  generate-summaries:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        include:
          - repository: project-api
            channel: C1234567890 # proj-api
          - repository: project-frontend
            channel: C2345678901 # proj-frontend
          - repository: project-infrastructure
            channel: C3456789012 # proj-infra
    steps:
      - name: Generate GitHub App Token
        id: app-token
        uses: actions/create-github-app-token@v2
        with:
          app-id: ${{ secrets.GH_APP_APP_ID }}
          private-key: ${{ secrets.GH_APP_PRIVATE_KEY }}
          repositories: |
            ${{ matrix.repository }}

      - name: Generate monthly summary
        uses: nakamasato/github-actions/monthly-project-summary-slack@1.13.1
        with:
          slack_channel: ${{ matrix.channel }}
          slack_bot_token: ${{ secrets.SLACK_BOT_TOKEN }}
          slack_team_id: ${{ secrets.SLACK_TEAM_ID }}
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          github_token: ${{ steps.app-token.outputs.token }}
          repository: ${{ github.repository_owner }}/${{ matrix.repository }}
```

## セットアップ手順

### 1. Slack Botの作成

1. [Slack API](https://api.slack.com/apps)でアプリを作成
2. Bot Tokenを取得（`xoxb-`で始まるトークン）
3. 必要な権限を付与：
   - `chat:write`
   - `channels:read`
   - `groups:read`

### 2. Claude Code認証の設定

Claude Code OAuth TokenまたはAnthropic API Keyのいずれかを取得：

- **Claude Code OAuth Token**: Claude Codeアプリケーションから取得
- **Anthropic API Key**: Anthropic Consoleから取得

### 3. GitHub App (Optional)

実行レポ以外のレポのサマリーを生成する場合には [Create GitHub App](https://docs.github.com/en/apps/creating-github-apps) を参考に作成。

### 4. GitHubシークレットの設定

リポジトリの設定から以下のシークレットを追加：

```
SLACK_BOT_TOKEN=xoxb-your-bot-token
SLACK_TEAM_ID=your-team-id
CLAUDE_CODE_OAUTH_TOKEN=your-oauth-token or ANTHROPIC_API_KEY=xxx
GH_APP_APP_ID=xxx (optional)
GH_APP_PRIVATE_KEY=xxx (optional)
```

## 技術的なポイント

### 1. PRデータの効率的な処理

PRが50件以上ある場合の処理最適化：

```bash
# 件数を確認
jq 'length' pr_data.json

# タイトルリストで全体像を把握
jq '.[].title' pr_data.json

# 重要なPRを特定してから詳細確認
```

### 2. カテゴリ分類の工夫

Claude Codeは以下の基準でPRを自動分類します：

- **機能開発**: 新機能追加、機能改善
- **テスト・品質向上**: テストコード追加、リファクタリング
- **インフラ・運用**: CI/CD、デプロイ、設定変更
- **ドキュメント**: READMEやドキュメントの更新
- **バグ修正**: バグフィックス、修正作業

### 3. エラーハンドリング

処理が失敗した場合、自動的にSlackにエラー通知を送信：

```yaml
- name: Send error notification to Slack
  if: failure()
  run: |
    curl -X POST -H 'Content-type: application/json' \
      -H "Authorization: Bearer ${{ secrets.slack_bot_token }}" \
      -d '{
        "channel": "${{ inputs.slack_channel }}",
        "text": "⚠️ *月次サマリー生成でエラーが発生しました*\n\n詳細は<https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}|こちら>をご確認ください。"
      }' \
      https://slack.com/api/chat.postMessage
```

## メリットと効果

今まではgh prにlabelをつけてラベルごとのmerged prのリストを作成したりして月次のPRをまとめたりしていました。今回のClaude Code GitHub ActionsとMCPのお陰で、内容を反映したカテゴリ別にUser-friendlyなサイズにまとめて情報がコンパクトになり可読性も上がりました。

また、最後にランダムな鼓舞するメッセージもついてくるので、ちょっとほっこりします。

Reusable Workflowを使ったことで、複数のレポへの導入がめちゃくちゃ楽になりました。GitHub OrgでSlack bot tokenを設定してどのレポでもコピペで設定できるようになりました。

## 今後の課題と展望

今後の課題と展望としては、

- 月次のまとめからNotion/ConfluenceなどのDocumentページ作成
- 月次まとめの自動生成ができたらQごとの活動まとめページの自動作成

によって、活動の記録を自動的にまとめていく仕組みを構築したいと思います。

また、突貫工事的に作ったので、

- Promptをガチガチの日本語で書いているのでProjectごとにカスタマイズできない
- ActiveでPR数がめちゃくちゃ多い場合にはTokenが超えてしまう

らへんを改善できるようにしたいと思っています。

## まとめ

Claude Code GitHub ActionsとSlack MCPを組み合わせることで、効率的な月次活動サマリーシステムを構築できました。このシステムにより：

- 開発チームの作業内容が自動的に整理・分類される
- 毎月の成果が分かりやすい形でSlackに共有される
- 手動でのレポート作成工数が大幅に削減される
- チーム内のコミュニケーションが促進される

特に、Claude Codeの自然言語処理能力により、技術的なPRタイトルから読みやすい日本語のサマリーが生成される点が大きな特徴です。

GitHub ActionsとAIを組み合わせた自動化により、開発チームの生産性向上と情報共有の改善を実現できる良い例だと思います。ぜひ、皆さんのプロジェクトでも活用してみてください！

## 参考リンク

- [monthly-project-summary-slack](https://github.com/nakamasato/github-actions/tree/main/monthly-project-summary-slack)
- [Claude Code GitHub Action](https://github.com/anthropics/claude-code-base-action)
- [GitHub Actions: Reusing workflows](https://docs.github.com/en/actions/using-workflows/reusing-workflows)

