---
title: postgres コマンド Cheatsheet
tags: PostgreSQL
author: nakamasato
slide: false
---
## Databases & tables

1. list databases: `\l`
2. use database: `\c newDatabaseName`
3. list tables: `\dt`
4. describe table: `\d table_name`  (show columns from)
5. schema check `\dn+`

## connection数

user ごとのconnection数の確認

```sql
SELECT usename, COUNT(*) AS connection_count
FROM pg_stat_activity
GROUP BY usename;
```

特定のUserのconnectionを終了する

```sql
SELECT pg_terminate_backend(pid)
FROM pg_stat_activity
WHERE usename = 'test_user';
```

## roles

### list

list roles:
```sql
\du
```

### create

```sql
CREATE USER test_user WITH PASSWORD 'test_user';
```

### grant

`cloudsqlsuperuser` を IAM userに付与 (CloudSQL)

```sql
grant "cloudsqlsuperuser" to "test-user@<gcp project>.iam";
```

初期ユーザに権限付与 (publicのすべての権限)

```sql
GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO test_user;
GRANT ALL ON SCHEMA public TO test_user;
```

### pg_roles

roleの権限確認

```sql
SELECT rolname, rolsuper, rolinherit, rolcreaterole, rolcreatedb, rolcanlogin, rolreplication
FROM pg_roles
WHERE rolname = 'test_user';
```

